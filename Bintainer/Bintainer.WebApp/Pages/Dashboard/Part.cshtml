@page "/dashboard/part"
@model PartModel
@{
}

<link rel="stylesheet" href="~/css/hierarchy-select.min.css">
<link rel="stylesheet" href="~/css/autocomplete.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js" type="module"></script> 
<style>
    ::placeholder {
        font-size: 12px;        
        font-style: italic;
    }
</style>

<div class="container">
    <div class="row">
        <div class="col-md-9">
            <form class="well form-horizontal" method="post">
                <fieldset>
                    <legend><h2>Part</h2></legend>
                    <hr />
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label">Part Name</label>
                                <input id="partName" name="partName" placeholder="e.g., 2N2222A" class="form-control" required="required" type="text">
                            </div>
                            <div class="form-group">
                                <label class="control-label">Description</label>
                                <input id="description" name="description" placeholder="e.g., TRANSISTOR DIS.800mA 50V NPN TO-18" class="form-control" required="required" type="text">
                            </div>
                            <div class="form-group">
                                <label class="control-label">Bin Label</label>
                                <input id="label" name="label" placeholder="e.g., 2N2222" class="form-control" type="text">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label">Package</label>
                                <input class="form-control autocomplete-input" data-source='["Resistor","Capacitor"]' type="text" name="package" placeholder="Package">
                            </div>
                            <div class="form-group">
                                <label class="control-label">Category</label>
                                <input class="form-control autocomplete-input" data-source='["Resistor","Capacitor"]' type="text" name="category" placeholder="Category">
                            </div>
                            <div class="form-group">
                                <label class="control-label">Group</label>
                                <input type="text" class="form-control autocomplete" id="autocompleteInput" placeholder="Type something" />                                
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend><h2>Attributes</h2></legend>
                    <hr />
                    <div class="button-row">
                        <div class="button-row" style="display: flex;">
                            <button class="btn btn-primary me-2 ms-2" id="addAttribute" target-table="attributeTable">Add Row</button>
                            <div class="dropdown search-dropdown" style="padding: 5px 10px;">
                                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Load template
                                </button>
                                <ul class="dropdown-menu pt-0">
                                    <input type="text" class="form-control border-0 border-bottom shadow-none mb-2 search-input" data-source='["Resistor","Capacitor","Transistor"]' placeholder="Search...">
                                </ul>
                            </div>
                        </div>

                        <div class="vertical-line" style="height: 35px;"></div>
                        <label class="control-label align-items-start">Save as</label>
                        <i class="bi bi-grip-vertical"></i>
                        <div class="col-md-4">
                            <div class=" inputGroupContainer">
                                <div class="input-group"><input id="templateName" name="templateName" class="form-control" value="" type="text"></div>
                            </div>
                        </div>


                    </div>                    
                    <table class="table" id="attributeTable">
                        <thead>
                            <tr>
                                <th>Product Attribute</th>
                                <th>Attribute Value</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="productSpecTable"></tbody>
                    </table>
                </fieldset>
                <fieldset>
                    <legend><h2>Suppliers</h2></legend>
                    <div class="button-row">
                        <button class="btn btn-primary me-2 ms-2" id="addSupplier" target-table="supplierTable">Add Row</button>
                    </div>
                    <table class="table" id="supplierTable">
                        <thead>
                            <tr>
                                <th>Supplier</th>
                                <th>Part Number</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="supplierPartNumberTable"></tbody>
                    </table>
                </fieldset>
                <fieldset>
                    <legend><h2>Order</h2></legend>
                    <div class="form-group">
                        <label class="col-md-2 control-label align-items-start">Order Number</label>
                        <div class="col-md-4">
                            <div class=" inputGroupContainer">
                                <div class="input-group"><input id="order" name="order" placeholder="Order number" class="form-control" value="" type="text"></div>
                            </div>
                        </div>
                        <label class="col-md-2 control-label align-items-start">Quantity</label>
                        <div class="col-md-4">
                            <div class=" inputGroupContainer">
                                <div class="input-group"><input id="orderQuantity" name="ordarQuantity" placeholder="Quantity" class="form-control" value="" type="text"></div>
                            </div>
                        </div>
                        <label class="col-md-2 control-label align-items-start" style="margin:10px 0 0 0">Order date</label>
                        <div class="col-md-4">
                            <div class=" inputGroupContainer" style="margin:10px 0 0 0">
                                <div class="input-group"><input id="orderDate" name="orderDate" placeholder="Order date" class="form-control" value="" type="date"></div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <div class="text-right">
                    <button type="button" class="btn btn-danger">Cancel</button>
                    <button type="button" class="btn btn-success">Create</button>
                </div>
            </form>                      
        </div>
        <div class="col-md-3">
            <div class="card card-custom">
                <button type="button" class="btn btn-secondary">Part</button>
                <img src="~/image/microchip.png" class="img-fluid" alt="part image"/>
            </div>
            <div class="card card-custom">
                <button type="button" class="btn btn-secondary">Footprint</button>
                <img src="~/image/pinout.png" class="img-fluid" alt="footpring" />
            </div>            
        </div>
    </div>
</div>

<script type="text/template" id="tr_template">
    <td class="dtable-col1"></td>
    <td class="dtable-col2"></td>
    <td><a data-mode='edit' class="action" href="javascript:void(0)">edit</a></td>
    <td><a class="delete" href="javascript:void(0)">delete</a></td>
</script> 


<script type="module">
    import Autocomplete from "https://cdn.jsdelivr.net/gh/lekoala/bootstrap5-autocomplete@master/autocomplete.js";
    const opts = {
        onSelectItem: console.log,
    };
    var src = [];
    for (let i = 0; i < 50; i++) {
        src.push({
            title: "Option " + i,
            id: "opt" + i,
            data: {
                key: i,
            },
        });
    }
    Autocomplete.init("input.autocomplete", {
        items: src,
        valueField: "id",
        labelField: "title",
        highlightTyped: true,
        onSelectItem: console.log,
    });
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#addAttribute').on('click', function () {
            var targetTableId = $(this).attr('target-table'); // Get the ID from the target-table attribute
            var table = $('#' + targetTableId); // Select the table using the ID
            if (table.length) { // Check if the table exists
                appendRowToTable(table); // Call the function with the table jQuery object
            } else {
                console.error('Table with ID "' + targetTableId + '" not found.');
            }
        });
        $('#addSupplier').on('click', function () {
            var targetTableId = $(this).attr('target-table'); // Get the ID from the target-table attribute
            var table = $('#' + targetTableId); // Select the table using the ID
            if (table.length) { // Check if the table exists
                appendRowToTable(table); // Call the function with the table jQuery object
            } else {
                console.error('Table with ID "' + targetTableId + '" not found.');
            }
        });
        $('.search-dropdown').each(function () {
            var $dropdown = $(this);
            var $input = $dropdown.find('.search-input');
            var $menu = $dropdown.find('.dropdown-menu');

            $input.on('input', function () {
                var inputValue = $input.val();
                var dataAttribute = $input.attr('data-source');
                var results = JSON.parse(dataAttribute);
                var matchingWords = inputValue ? results.filter(word => word.toLowerCase().includes(inputValue.toLowerCase())) : results;

                $menu.find('li').remove(); // Remove existing list items
                populateList(matchingWords, $menu, $dropdown.find('.dropdown-toggle'));
            });
        });

    });
</script>

